import{r as s,j as r}from"./index-B8HERFIK.js";const B=({onSubmit:I,transactions:y=[],initialData:o,onCancel:S,submitLabel:z})=>{const[g,p]=s.useState(o?.name||""),[f,u]=s.useState(o?String(o.price):""),[i,c]=s.useState(o?.tags||[]),[a,m]=s.useState(""),[b,x]=s.useState(()=>{const e=o?new Date(o.created_at):new Date,t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().slice(0,16)}),[l,w]=s.useState(!1);s.useEffect(()=>{if(o){p(o.name),u(String(o.price)),c(o.tags?.filter(h=>h.trim()!=="")||[]);const e=new Date(o.created_at),t=e.getTimezoneOffset()*6e4,n=new Date(e.getTime()-t).toISOString().slice(0,16);x(n)}else{p(""),u(""),c([]);const e=new Date,t=e.getTimezoneOffset()*6e4,n=new Date(e.getTime()-t).toISOString().slice(0,16);x(n)}},[o]);const R=s.useRef(null),d=s.useRef(null),v=s.useRef(null),E=s.useRef(null),C=s.useMemo(()=>{const e={};return y.forEach(t=>{t.tags.forEach(n=>{n&&n.trim()&&(e[n]=(e[n]||0)+1)})}),Object.entries(e).sort((t,n)=>n[1]-t[1]).map(([t])=>t)},[y]),j=s.useMemo(()=>C.filter(e=>e.trim()!==""&&!i.includes(e)&&e.toLowerCase().includes(a.toLowerCase())),[C,a,i]),k=e=>{const t=e.trim();t&&!i.includes(t)&&c([...i,t]),m(""),v.current?.focus()},O=e=>{c(i.filter(t=>t!==e))},T=async()=>{if(!g||l)return;w(!0);const e=[...i];a.trim()&&!i.includes(a.trim())&&e.push(a.trim());try{if(await I({name:g,price:f?Number(f):0,tags:e,description:o?.description||"",created_at:new Date(b).toISOString()}),!o){p(""),u(""),c([]),m("");const t=new Date,n=t.getTimezoneOffset()*6e4,h=new Date(t.getTime()-n).toISOString().slice(0,16);x(h)}}finally{w(!1)}};return r.jsxs("div",{className:"card",style:{padding:"20px",border:"1px solid var(--border-color)",borderRadius:"8px",backgroundColor:"var(--bg-card)"},children:[r.jsxs("div",{style:{marginBottom:"15px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsx("div",{style:{fontSize:"18px",fontWeight:"500",color:"var(--text-main)"},children:b.replace("T"," ")}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{type:"button",style:{backgroundColor:"var(--bg-item)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"8px",color:"var(--text-main)",display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsx("span",{className:"material-icons",style:{fontSize:"20px"},children:"calendar_month"})}),r.jsx("input",{ref:E,type:"datetime-local",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,zIndex:10,cursor:"pointer"},value:b,onChange:e=>x(e.target.value),onClick:e=>{try{"showPicker"in e.currentTarget&&e.currentTarget.showPicker()}catch(t){console.error(t)}}})]})]}),r.jsx("div",{style:{marginBottom:"15px"},children:r.jsx("input",{ref:R,type:"number",inputMode:"decimal",style:{width:"100%",padding:"8px",fontSize:"16px",backgroundColor:"var(--input-bg)",color:"var(--text-main)",border:"1px solid var(--border-color)",borderRadius:"4px",boxSizing:"border-box"},placeholder:"How much?",value:f,onChange:e=>u(e.target.value),onKeyDown:e=>{e.key==="Enter"&&d.current?.focus()}})}),r.jsx("div",{style:{marginBottom:"15px"},children:r.jsx("input",{ref:d,style:{width:"100%",padding:"8px",fontSize:"16px",backgroundColor:"var(--input-bg)",color:"var(--text-main)",border:"1px solid var(--border-color)",borderRadius:"4px",boxSizing:"border-box"},placeholder:"What are you buying?",value:g,onChange:e=>p(e.target.value),onCompositionStart:()=>{const e=d.current;e&&(e.isComposing=!0)},onCompositionEnd:()=>{const e=d.current;e&&(e.isComposing=!1)},onKeyDown:e=>{e.nativeEvent.isComposing||d.current?.isComposing||e.key==="Enter"&&v.current?.focus()}})}),r.jsxs("div",{style:{marginBottom:"20px"},children:[r.jsxs("div",{style:{border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--input-bg)",padding:"8px",display:"flex",flexDirection:"column"},children:[i.length>0&&r.jsx("div",{style:{display:"flex",flexWrap:"nowrap",gap:"8px",marginBottom:"5px",overflowX:"auto",paddingBottom:"4px"},children:i.map(e=>r.jsxs("span",{style:{backgroundColor:"var(--primary)",color:"var(--text-inv)",borderRadius:"16px",padding:"4px 12px",display:"flex",alignItems:"center",fontSize:"14px",flexShrink:0,whiteSpace:"nowrap"},children:[e,r.jsx("button",{onClick:t=>{t.preventDefault(),O(e)},style:{background:"none",border:"none",marginLeft:"6px",cursor:"pointer",color:"inherit",padding:0,display:"flex",alignItems:"center"},children:r.jsx("span",{className:"material-icons",style:{fontSize:"14px"},children:"close"})})]},e))}),r.jsx("input",{ref:v,style:{width:"100%",padding:"0",fontSize:"16px",backgroundColor:"transparent",color:"var(--text-main)",border:"none",outline:"none",boxSizing:"border-box"},placeholder:i.length>0?"Add another tag...":"Add tags...",value:a,onChange:e=>m(e.target.value),onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),a.trim()?k(a.trim()):T())}})]}),(a||j.length>0)&&r.jsx("div",{style:{display:"flex",flexWrap:"nowrap",gap:"8px",marginTop:"10px",overflowX:"auto",paddingBottom:"4px"},children:j.slice(0,15).map(e=>r.jsxs("button",{onClick:t=>{t.preventDefault(),k(e)},style:{backgroundColor:"var(--bg-item)",border:"1px solid var(--border-color)",borderRadius:"16px",padding:"4px 12px",fontSize:"14px",cursor:"pointer",color:"var(--text-main)",flexShrink:0,whiteSpace:"nowrap"},children:["+ ",e]},e))})]}),r.jsxs("div",{style:{display:"flex",gap:"10px"},children:[S&&r.jsx("button",{onClick:S,style:{padding:"12px",backgroundColor:"var(--text-secondary)",color:"var(--text-inv)",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",width:"100px"},children:"Cancel"}),r.jsx("button",{onClick:T,disabled:l,style:{flex:1,padding:"12px",backgroundColor:l?"var(--primary-bg-subtle)":"var(--primary)",color:"var(--text-inv)",border:"none",borderRadius:"4px",fontSize:"16px",cursor:l?"not-allowed":"pointer",opacity:l?.8:1},children:l?"Saving...":z||(o?"Save Changes":"Add Transaction")})]})]})};export{B as default};
