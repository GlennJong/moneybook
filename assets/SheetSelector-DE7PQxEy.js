import{r as l,j as e,f as b,a as u}from"./index-B8HERFIK.js";const y=({isNew:c,file:s,onSelect:d})=>{const[r,n]=l.useState(!1),[t,i]=l.useState(!c),p=async()=>{try{if(s.description&&s.scriptUrl){n(!0);const a=await b(s.scriptUrl);i(!0),d(a),n(!1)}}catch(a){console.error("Invalid file description",a),i(!1),n(!1)}};return e.jsx("div",{style:{backgroundColor:"var(--bg-card)",border:"1px solid var(--border-color)",color:"var(--text-main)",borderRadius:"8px",padding:"16px",marginBottom:"12px",boxShadow:"0 2px 5px var(--shadow-color)",transition:"transform 0.1s ease-in-out"},children:e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"12px"},children:[e.jsx("span",{className:"material-icons",style:{fontSize:"24px",marginRight:"8px",color:"var(--primary)"},children:"description"}),e.jsx("h3",{style:{margin:0,fontSize:"1.1rem",fontWeight:"bold"},children:s.name.replace("moneybook-","")})]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("a",{href:s.webViewLink,target:"_blank",rel:"noreferrer",style:{flex:1,textDecoration:"none"},children:e.jsxs("button",{style:{width:"100%",padding:"10px",background:"var(--bg-item)",color:"var(--text-main)",border:"1px solid var(--border-color)",borderRadius:"6px",cursor:"pointer",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[e.jsx("span",{className:"material-icons",style:{fontSize:"16px"},children:"open_in_new"}),"Open"]})}),e.jsx("button",{disabled:r||t!==!0,onClick:p,style:{flex:2,padding:"10px",backgroundColor:r||t!==!0?"var(--input-bg)":"var(--primary)",color:r||t!==!0?"var(--text-muted)":"var(--text-inv)",border:"none",borderRadius:"6px",cursor:r||t!==!0?"not-allowed":"pointer",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner",style:{width:"14px",height:"14px",border:"2px solid",borderTopColor:"transparent",borderRadius:"50%",display:"inline-block",animation:"spin 1s linear infinite"}}),"Loading",e.jsx("style",{children:"@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-icons",style:{fontSize:"18px"},children:"check"}),"Select"]})})]}),t===!1&&e.jsxs("div",{style:{marginTop:"12px",padding:"10px",backgroundColor:"var(--warning-bg-subtle)",borderRadius:"6px",border:"1px solid var(--warning)"},children:[e.jsx("p",{style:{margin:"0 0 8px 0",color:"var(--text-main)",fontSize:"0.9rem"},children:"Access authorization required."}),e.jsx("button",{onClick:()=>{const a=s.scriptUrl;window.open(a,"auth","width=600,height=400"),i(!0)},style:{width:"100%",backgroundColor:"var(--primary)",color:"var(--text-inv)",border:"none",padding:"8px",borderRadius:"4px",cursor:"pointer",fontWeight:"500"},children:"Authorize"})]})]},s.id)})},m=({createSheet:c,fetchFiles:s,onCreate:d})=>{const[r,n]=l.useState(""),[t,i]=l.useState(!1),p=async()=>{if(r.trim()){i(!0);try{await c({sheetName:r,prefix:"moneybook-",columns:[{name:"name",type:"string"},{name:"price",type:"number"},{name:"tags",type:"string"}]}),await s("moneybook-"),d(r),n("")}catch(a){console.error(a),alert("Failed to create sheet")}finally{i(!1)}}};return e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%"},children:[e.jsx("input",{type:"text",value:r,onChange:a=>n(a.target.value),placeholder:"New Sheet Name",disabled:t,style:{flex:1,padding:"0 12px",height:"40px",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:t?"var(--bg-main)":"var(--input-bg)",color:"var(--text-main)",boxSizing:"border-box"}}),e.jsx("button",{onClick:p,disabled:!r.trim()||t,style:{height:"40px",padding:"0 20px",borderRadius:"4px",border:"none",backgroundColor:!r.trim()||t?"var(--input-bg)":"var(--primary)",color:!r.trim()||t?"var(--text-muted)":"var(--text-inv)",cursor:!r.trim()||t?"not-allowed":"pointer",whiteSpace:"nowrap",display:"flex",alignItems:"center",fontWeight:"500"},children:"Create"})]}),t&&e.jsxs("div",{style:{marginTop:"12px",color:"var(--text-secondary)",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},children:[e.jsx("span",{className:"spinner",style:{width:"16px",height:"16px",border:"2px solid var(--primary)",borderTopColor:"transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),'Creating "',r,'"... please wait.',e.jsx("style",{children:"@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }"})]})]})},f=({token:c,onSelect:s})=>{const{createSheet:d,fetchFiles:r,loading:n,files:t}=u.useSheetManager(c),[i,p]=l.useState(!0),[a,x]=l.useState([]);l.useEffect(()=>{r("moneybook-").finally(()=>p(!1))},[]);const g=o=>{localStorage.setItem("vibe_script_url",o),s(o)};return i||n&&t.length===0?e.jsxs("div",{className:"card",style:{backgroundColor:"var(--bg-card)",color:"var(--text-main)",border:"1px solid var(--border-color)"},children:[e.jsx("h3",{children:"Syncing your Moneybooks..."}),e.jsx("p",{children:"Please wait while we fetch your data."})]}):t.length===0?e.jsxs("div",{className:"card",style:{backgroundColor:"var(--bg-card)",color:"var(--text-main)",border:"1px solid var(--border-color)"},children:[e.jsx("h2",{children:"Welcome to MoneyBook"}),e.jsxs("div",{style:{padding:"1.5rem",background:"var(--bg-item)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[e.jsx("h3",{children:"No Moneybooks Found"}),e.jsx("p",{style:{marginBottom:"1rem",color:"var(--text-secondary)"},children:"It looks like you don't have a MoneyBook backend yet."}),e.jsx(m,{createSheet:d,fetchFiles:r,onCreate:o=>x([...a,o])}),e.jsx("button",{className:"secondary",onClick:()=>r("moneybook-"),disabled:n,style:{marginTop:"10px",padding:"8px 16px",background:"transparent",border:"1px solid var(--text-secondary)",color:"var(--text-secondary)",borderRadius:"4px",cursor:"pointer"},children:"Check Again"})]})]}):e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",padding:"0 1rem"},children:[e.jsx("h2",{style:{textAlign:"center",marginBottom:"2rem",color:"var(--text-main)"},children:"Select MoneyBook"}),e.jsxs("div",{style:{marginBottom:"2rem",padding:"1.5rem",backgroundColor:"var(--bg-card)",borderRadius:"12px",border:"1px solid var(--border-color)",boxShadow:"0 2px 8px var(--shadow-color)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1.1rem",color:"var(--text-main)",fontWeight:"600",textAlign:"center"},children:"Create New Book"}),e.jsx(m,{createSheet:d,fetchFiles:r,onCreate:o=>x([...a,o])})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem",padding:"0 4px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"var(--text-secondary)",fontWeight:"500"},children:"Existing Books"}),e.jsxs("button",{onClick:()=>r("moneybook-"),disabled:n,style:{background:"transparent",border:"none",color:"var(--primary)",cursor:n?"wait":"pointer",display:"flex",alignItems:"center",gap:"6px",fontSize:"0.9rem",padding:"4px 8px",borderRadius:"4px"},onMouseEnter:o=>o.currentTarget.style.backgroundColor="var(--bg-item)",onMouseLeave:o=>o.currentTarget.style.backgroundColor="transparent",children:[e.jsx("span",{className:"material-icons",style:{fontSize:"18px",animation:n?"spin 1s linear infinite":"none"},children:"refresh"}),"Refresh",n&&e.jsx("style",{children:"@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }"})]})]}),e.jsx("div",{className:"file-grid",style:{marginTop:0},children:t.map(o=>e.jsx(y,{isNew:a.some(h=>o.name.includes(h)),file:o,onSelect:()=>{o.scriptUrl&&g(o.scriptUrl)}},o.id))}),t.length===0&&!n&&e.jsx("div",{style:{textAlign:"center",color:"var(--text-secondary)",padding:"2rem"},children:"No books found. Create one above!"})]})};export{f as default};
