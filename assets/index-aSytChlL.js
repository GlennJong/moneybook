import{j as t,r as s}from"./index-B8HERFIK.js";const M=({isOpen:p,onClose:g,months:u,onSelect:b})=>p?t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--modal-overlay)",zIndex:1e3,display:"flex",justifyContent:"center",alignItems:"center"},onClick:g,children:t.jsxs("div",{style:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"20px",width:"80%",maxWidth:"300px",maxHeight:"70vh",overflowY:"auto",boxShadow:"0 4px 6px var(--shadow-color)"},onClick:i=>i.stopPropagation(),children:[t.jsx("h3",{style:{marginTop:0,textAlign:"center"},children:"Jump to Month"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[u.map(i=>t.jsx("button",{onClick:()=>b(i),style:{padding:"10px",border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-item)",color:"var(--text-main)",cursor:"pointer",fontSize:"1em"},children:i},i)),u.length===0&&t.jsx("p",{style:{textAlign:"center",color:"var(--text-muted)"},children:"No records found"})]}),t.jsx("button",{onClick:g,style:{marginTop:"20px",width:"100%",padding:"10px",backgroundColor:"transparent",border:"none",color:"var(--text-secondary)",cursor:"pointer"},children:"Cancel"})]})}):null,R=({children:p,onDelete:g,onClick:u,className:b})=>{const[i,x]=s.useState(0),[C,f]=s.useState(!1),S=s.useRef(0),j=s.useRef(0),d=s.useRef(0),k=s.useRef(0),v=s.useRef(!1),h=80,y=a=>{d.current=a.touches[0].clientX,k.current=a.touches[0].clientY,S.current=a.touches[0].clientX,j.current=i,v.current=!0,f(!0)},T=a=>{if(!v.current)return;const w=a.touches[0].clientX,E=a.touches[0].clientY,e=w-d.current,r=E-k.current;if(Math.abs(r)>Math.abs(e))return;let o=j.current+e;o>0&&(o=0),o<-h-20&&(o=-h-20),x(o)},m=()=>{v.current=!1,f(!1),i<-40?x(-h):x(0)},I=a=>{a.stopPropagation(),g(),x(0)};return t.jsxs("div",{className:b,style:{position:"relative",overflow:"hidden"},children:[t.jsx("div",{style:{position:"absolute",top:0,bottom:0,right:0,width:"100%",backgroundColor:"var(--danger)",display:"flex",justifyContent:"flex-end",alignItems:"center",zIndex:0},children:t.jsx("button",{onClick:I,style:{width:h,height:"100%",border:"none",background:"transparent",color:"var(--text-inv)",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("span",{className:"material-icons",children:"delete"})})}),t.jsx("div",{onClick:u,onTouchStart:y,onTouchMove:T,onTouchEnd:m,style:{transform:`translateX(${i}px)`,transition:C?"none":"transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",backgroundColor:"var(--bg-item)",position:"relative",zIndex:1,height:"100%",touchAction:"pan-y"},children:p})]})},_=({transactions:p,removeTransaction:g,syncFromCloud:u,onEdit:b})=>{const[i,x]=s.useState(null),[C,f]=s.useState(!1),[S,j]=s.useState(!1),[d,k]=s.useState(!1),[v,h]=s.useState(!0),y=s.useRef(0);s.useEffect(()=>{const e=()=>j(window.matchMedia("(max-width: 768px)").matches);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{const e=document.getElementById("main-scroll-container");if(!e)return;y.current=e.scrollTop;const r=()=>{const o=e.scrollTop;o>y.current&&o>50?h(!1):h(!0),y.current=o};return e.addEventListener("scroll",r),()=>e.removeEventListener("scroll",r)},[]);const T=s.useMemo(()=>{const e={};p.flatMap(n=>n.tags||[]).filter(Boolean).forEach(n=>{e[n]=(e[n]||0)+1});const r=Object.entries(e).sort((n,c)=>c[1]-n[1]).map(([n])=>n),o=Number(localStorage.getItem("moneybook_max_tags")||10);return o>0?r.slice(0,o):r},[p]),m=s.useMemo(()=>{let e=p;if(i&&(e=e.filter(r=>r.tags?.includes(i))),d){const r=Number(localStorage.getItem("moneybook_big_purchase_threshold")||1e3);e=e.filter(o=>o.price>=r)}return[...e].sort((r,o)=>new Date(r.created_at).getTime()-new Date(o.created_at).getTime())},[i,p,d]),I=s.useMemo(()=>m.reduce((e,r)=>e+r.price,0),[m]),a=s.useMemo(()=>{const e={};return m.forEach(r=>{const n=new Date(r.created_at).toLocaleString("default",{year:"numeric",month:"long"});e[n]||(e[n]={total:0,items:[]}),e[n].items.push(r),e[n].total+=r.price}),e},[m]);s.useEffect(()=>{u()},[u]),s.useLayoutEffect(()=>{const e=document.getElementById("main-scroll-container");e&&(e.scrollTop=e.scrollHeight)},[]);const w=e=>{f(!1);const r=document.getElementById(`month-${e}`),o=document.getElementById("main-scroll-container");if(r&&o){const c=r.getBoundingClientRect().top-o.getBoundingClientRect().top,l=o.scrollTop;o.scrollTo({top:l+c-60,behavior:"smooth"})}},E=()=>{const e=document.getElementById("main-scroll-container");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})};return t.jsxs("div",{style:{padding:"20px"},children:[t.jsx(M,{isOpen:C,onClose:()=>f(!1),months:Object.keys(a),onSelect:w}),t.jsxs("div",{style:{textAlign:"center",fontSize:"1.2em",marginBottom:"20px",fontWeight:"bold"},children:["Total: $",I.toLocaleString()]}),t.jsxs("div",{style:{position:"fixed",bottom:"calc(80px + env(safe-area-inset-bottom))",left:"20px",right:"20px",backgroundColor:"var(--bg-card)",backdropFilter:"blur(10px)",borderRadius:"16px",padding:"10px 15px",boxShadow:"0 4px 15px var(--shadow-color)",display:"flex",alignItems:"center",gap:"15px",zIndex:900,transform:v?"translateY(0)":"translateY(150%)",transition:"transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",border:"1px solid var(--border-color)"},children:[t.jsx("button",{onClick:()=>k(!d),style:{background:"none",border:"none",fontSize:"1.2rem",cursor:"pointer",padding:"8px",borderRadius:"50%",backgroundColor:d?"var(--primary-bg-subtle)":"transparent",color:d?"var(--primary)":"var(--text-main)",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s",flexShrink:0},title:`Show Big Purchases Only (>= $${Number(localStorage.getItem("moneybook_big_purchase_threshold")||1e3)})`,children:t.jsx("span",{className:"material-icons",children:d?"savings":"attach_money"})}),t.jsx("div",{style:{width:"1px",height:"24px",backgroundColor:"var(--border-color)",flexShrink:0}}),t.jsx("button",{onClick:E,style:{background:"none",border:"none",fontSize:"1.2rem",cursor:"pointer",padding:"8px",borderRadius:"50%",color:"var(--text-main)",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s",flexShrink:0},title:"Scroll to Bottom",children:t.jsx("span",{className:"material-icons",children:"arrow_downward"})}),t.jsx("div",{style:{width:"1px",height:"24px",backgroundColor:"var(--border-color)",flexShrink:0}}),t.jsxs("div",{style:{display:"flex",overflowX:"auto",gap:"8px",scrollbarWidth:"none",msOverflowStyle:"none",paddingRight:"10px",alignItems:"center"},children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:`
            ::-webkit-scrollbar { display: none; }
          `}}),t.jsx("button",{onClick:()=>x(null),style:{backgroundColor:i===null?"var(--primary)":"var(--bg-item)",color:i===null?"var(--text-inv)":"var(--text-main)",border:i===null?"none":"1px solid var(--border-color)",padding:"6px 12px",borderRadius:"20px",cursor:"pointer",whiteSpace:"nowrap",fontSize:"0.9rem",fontWeight:500,flexShrink:0},children:"All"}),T.map(e=>t.jsx("button",{onClick:()=>x(e),style:{backgroundColor:i===e?"var(--primary)":"var(--bg-item)",color:i===e?"var(--text-inv)":"var(--text-main)",border:i===e?"none":"1px solid var(--border-color)",padding:"6px 12px",borderRadius:"20px",cursor:"pointer",whiteSpace:"nowrap",fontSize:"0.9rem",fontWeight:500,flexShrink:0},children:e},e))]})]}),t.jsxs("div",{className:"transaction-list",children:[Object.entries(a).map(([e,r])=>t.jsxs("div",{id:`month-${e}`,style:{marginBottom:"30px",scrollMarginTop:"60px"},children:[t.jsxs("div",{onClick:()=>!S&&f(!0),style:{display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"var(--bg-card)",padding:"10px",borderRadius:"8px",marginBottom:"10px",position:"sticky",top:0,zIndex:10,boxShadow:"0 4px 6px -1px var(--shadow-color)",cursor:"pointer",border:"1px solid var(--border-color)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("h3",{style:{margin:0},children:e}),t.jsx("span",{style:{fontSize:"0.8em",color:"var(--text-muted)"},children:"▼"})]}),t.jsxs("span",{style:{fontWeight:"bold"},children:["$",r.total.toLocaleString()]}),S&&t.jsx("select",{value:e,onChange:o=>w(o.target.value),style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"},children:Object.keys(a).map(o=>t.jsx("option",{value:o,children:o},o))})]}),(()=>{const o=[];let n=null;return r.items.forEach(c=>{const l=new Date(c.created_at),B=l.toDateString();(!n||n.dateStr!==B)&&(n={dateStr:B,date:l,items:[],total:0},o.push(n)),n.items.push(c),n.total+=c.price}),o.map(c=>t.jsxs("div",{style:{marginBottom:"10px"},children:[t.jsxs("div",{style:{padding:"8px 4px",backgroundColor:"var(--bg-main)",fontSize:"0.9em",color:"var(--text-secondary)",display:"flex",justifyContent:"space-between",borderBottom:"1px solid var(--border-color)",fontWeight:"bold"},children:[t.jsx("span",{children:c.date.toLocaleDateString(void 0,{month:"numeric",day:"numeric",weekday:"short"})}),t.jsxs("span",{children:["$",c.total.toLocaleString()]})]}),c.items.map(l=>t.jsx(R,{onDelete:()=>g(l.id),onClick:()=>b(l),children:t.jsxs("div",{style:{padding:"12px 10px",borderBottom:"1px solid var(--border-color)",backgroundColor:"var(--bg-item)",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:l.syncStatus==="pending"?.7:1,cursor:"pointer"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[t.jsx("div",{style:{fontWeight:"bold",fontSize:"1rem",color:"var(--text-main)"},children:l.name}),t.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-muted)",display:"flex",alignItems:"center"},children:[l.tags.join(", "),l.syncStatus==="pending"&&t.jsx("span",{style:{color:"var(--warning)",marginLeft:"5px"},children:"●"}),l.syncStatus==="error"&&t.jsx("span",{style:{color:"var(--danger)",marginLeft:"5px"},children:"!"})]})]}),t.jsxs("div",{style:{fontWeight:"bold",color:"var(--text-main)"},children:["$",l.price.toLocaleString()]})]})},l.id))]},c.dateStr))})()]},e)),m.length===0&&t.jsx("div",{style:{textAlign:"center",color:"var(--text-muted)",marginTop:"40px"},children:"No transactions found."})]})]})};export{_ as default};
